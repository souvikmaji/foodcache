<html lang="en">
  <head>
    <meta name="google-signin-scope" content="profile email">
    <meta name="google-signin-client_id" content="<client_id>.apps.googleusercontent.com">
    <script src="https://apis.google.com/js/platform.js" async defer></script>
    <script src="https://ajax.googleapis.com/ajax/libs/jquery/3.2.1/jquery.min.js"></script>

  </head>
  <body>
    <div class="g-signin2" data-onsuccess="onSignIn" data-theme="dark"></div>
    <script>
      function onSignIn(googleUser) {
        // Useful data for your client-side scripts:
        var profile = googleUser.getBasicProfile();

        // The ID token you need to pass to your backend:
        var id_token = googleUser.getAuthResponse().id_token;
        console.log("ID Token: " + id_token);

        $.ajax({
          url: '/redirect',
          data: {
            id: profile.getId(),
            full_name: profile.getName(),
            given_name: profile.getGivenName(),
            family_name: profile.getFamilyName(),
            image_url: profile.getImageUrl(),
            email: profile.getEmail(),
            token: id_token,
          },
          method: 'post',
          success: function(data) {
            document.open();
            document.write(data);
            document.close();
          },
          error: function(data) {
            console.log("error occurred");
          }
      });
      };
    </script>
  </body>
</html>
